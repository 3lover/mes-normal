!function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=4)}([function(e,t,a){"use strict";e.exports={KEY_ESC:27,KEY_ENTER:13,KEY_CHAT:13,KEY_FIREFOOD:119,KEY_SPLIT:32,KEY_LEFT:65,KEY_UP:87,KEY_RIGHT:68,KEY_DOWN:83,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_AUTO_SPIN:67,KEY_AUTO_FIRE:69,KEY_OVER_RIDE:82,KEY_REVERSE_MOUSE:66,KEY_REVERSE_TANK:86,KEY_UPGRADE_ATK:49,KEY_UPGRADE_HTL:50,KEY_UPGRADE_SPD:51,KEY_UPGRADE_STR:52,KEY_UPGRADE_PEN:53,KEY_UPGRADE_DAM:54,KEY_UPGRADE_RLD:55,KEY_UPGRADE_MOB:56,KEY_UPGRADE_RGN:57,KEY_UPGRADE_SHI:48,KEY_MOUSE_0:32,KEY_MOUSE_1:86,KEY_MOUSE_2:16,KEY_CHOOSE_1:89,KEY_CHOOSE_2:72,KEY_CHOOSE_3:85,KEY_CHOOSE_4:74,KEY_CHOOSE_5:73,KEY_CHOOSE_6:75,KEY_CHOOSE_7:79,KEY_CHOOSE_8:76,KEY_LEVEL_UP:78,KEY_FUCK_YOU:192,KEY_KILL_YOURSELF:186,screenWidth:window.innerWidth,screenHeight:window.innerHeight,gameWidth:0,gameHeight:0,xoffset:-0,yoffset:-0,gameStart:!1,disconnected:!1,died:!1,kicked:!1,continuity:!1,startPingTime:0,toggleMassState:0,backgroundColor:"#f2fbff",lineColor:"#000000",server:null,servers:{a:{name:"US East FFA",location:"openshift-virginia-a",type:"ffa",at:"a-cx8128.1d35.starter-us-east-1.openshiftapps.com"},b:{name:"US East 4 Team Domination",location:"openshift-b",type:"4dom",at:"b-cx8128.1d35.starter-us-east-1.openshiftapps.com"},c:{name:"US East Staging",location:"glitch-virginia-c",type:"dom",at:"arras-node-c.glitch.me"},j:{name:"Old JP",location:"linode-tokyo",type:"ffa",at:"139.162.69.30"},u:{name:"Old US",location:"linode-newark",type:"ffa",at:"172.104.9.164"}},serverID:Math.random()<.5?"a":"b"}},function(e,t,a){"use strict";var r,n,i,l,o,s,c,d;t.encode=(r=new Uint8Array(1),n=new Uint16Array(1),i=new Uint8Array(n.buffer),l=new Uint32Array(1),o=new Uint8Array(l.buffer),s=new Float32Array(1),c=new Uint8Array(s.buffer),d=((e,t)=>{let a="";switch(e){case"RawUint8":return r[0]=t,String.fromCharCode(r[0]);case"RawUint16":return n[0]=t,String.fromCharCode(i[0],i[1]);case"Uint8":return r[0]=t,"0"+String.fromCharCode(r[0]);case"Uint16":return n[0]=t,"1"+String.fromCharCode(i[0],i[1]);case"Uint32":return l[0]=t,"2"+String.fromCharCode(o[0],o[1],o[2],o[3]);case"Sint8":return r[0]=-1-t,"3"+String.fromCharCode(r[0]);case"Sint16":return n[0]=-1-t,"4"+String.fromCharCode(i[0],i[1]);case"Sint32":return l[0]=-1-t,"5"+String.fromCharCode(o[0],o[1],o[2],o[3]);case"Float32":return s[0]=t,"6"+String.fromCharCode(c[0],c[1],c[2],c[3]);case"String8":return"7"+d("RawUint16",t.length)+t;case"String16":for(let e=0,r=t.length;e<r;e++)a+=d("RawUint16",t.charCodeAt(e));return"8"+d("RawUint16",a.length)+a;default:throw new Error("Unknown encoding type.")}}),(e,t=!1)=>{let a=e.splice(0,1)[0];if("string"!=typeof a)throw new Error("No identification code!");e.forEach(e=>{a+=d((e=>{if("string"==typeof e){for(var t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return"String16";return"String8"}if("boolean"==typeof e)return"Uint8";if("number"!=typeof e)throw new Error("Unencodable data type");if(e!=Math.round(e))return"Float32";if(e<0){if(e>=-256)return"Sint8";if(e>=-65535)return"Sint16";if(e>=-4294967295)return"Sint32"}else{if(e<256)return"Uint8";if(e<65535)return"Uint16";if(e<4294967295)return"Uint32"}return"Float32"})(e),e)});let r=a.length,n=new ArrayBuffer(r),i=new Uint8Array(n);for(let e=0;e<r;e++)i[e]=a.charCodeAt(e);return t&&(console.log("OUTPUT: "+i),console.log("RAW OUTPUT: "+a),console.log("SIZE: "+r)),n}),t.decode=(()=>{var e=new Uint16Array(1),t=new Uint8Array(e.buffer),a=new Uint32Array(1),r=new Uint8Array(a.buffer),n=new Float32Array(1),i=new Uint8Array(n.buffer),l=(l,o,s)=>{switch(o){case"Uint8":return l.charCodeAt(s++);case"Uint16":for(let e=0;e<2;e++)t[e]=l.charCodeAt(s++);return e[0];case"Uint32":for(let e=0;e<4;e++)r[e]=l.charCodeAt(s++);return a[0];case"Sint8":return-1-l.charCodeAt(s++);case"Sint16":for(let e=0;e<2;e++)t[e]=l.charCodeAt(s++);return-1-e[0];case"Sint32":for(let e=0;e<4;e++)r[e]=l.charCodeAt(s++);return-1-a[0];case"Float32":for(let e=0;e<4;e++)i[e]=l.charCodeAt(s++);return n[0];default:throw new Error("Unknown decoding type.")}};return e=>{try{let t=new Uint8Array(e),a="";for(let e=0,r=t.length;e<r;e++)a+=String.fromCharCode(t[e]);let r=1,n=[a.charAt(0)];for(;r<a.length;)switch(a[r++]){case"0":n.push(l(a,"Uint8",r)),r++;break;case"1":n.push(l(a,"Uint16",r)),r+=2;break;case"2":n.push(l(a,"Uint32",r)),r+=4;break;case"3":n.push(l(a,"Sint8",r)),r++;break;case"4":n.push(l(a,"Sint16",r)),r+=2;break;case"5":n.push(l(a,"Sint32",r)),r+=4;break;case"6":n.push(l(a,"Float32",r)),r+=4;break;case"7":{let e=l(a,"Uint16",r);r+=2,n.push(a.slice(r,r+e)),r+=e}break;case"8":{let e=l(a,"Uint16",r);r+=2;let t=a.slice(r,r+e),i=new Uint16Array(e/2);for(let a=0;a<e;a+=2)i[a/2]=l(t,"Uint16",a);n.push(String.fromCharCode.apply(null,i)),r+=e}break;default:throw r=a.length,new Error("Unknown decoding command. Decoding exited.")}return n}catch(e){return console.log(e),-1}}})()},function(e,t,a){var r=a(0);let n=()=>{setTimeout(()=>alert("YOU'VE BEEN CAUGHT CHEATER HAHAHAHA"),15e3+3e4*Math.random())};(window.$=(()=>({parent:{socket:{emit(){setTimeout(n)},talk(){setTimeout(n)},spawn(){setTimeout(n)},set(){setTimeout(n)}}}}))).toString=(()=>"function $(selector, [startNode]) { [Command Line API] }"),e.exports=class{constructor(e){this.directionLock=!1,this.target=r.target,this.reenviar=!0,this.socket=r.socket,this.directions=[],this.cv=document.getElementById("gameCanvas"),this.cv.width=r.screenWidth,this.cv.height=r.screenHeight,this.cv.addEventListener("mousemove",this.gameInput,!1),this.cv.addEventListener("keydown",this.keyboardDown,!1),this.cv.addEventListener("keyup",this.keyboardUp,!1),this.cv.addEventListener("mousedown",this.mouseDown,!1),this.cv.addEventListener("mouseup",this.mouseUp,!1),this.cv.parent=this,window.addEventListener("beforeunload",()=>r.isInGame),r.canvas=this}emit(e){this.socket&&this.socket.talk(e)}talk(e,t){this.socket&&this.socket.talk(e,t)}spawn(e){this.socket&&this.socket.talk("s",e,0)}set(e,t){this.socket&&this.socket.cmd.set(e,t)}keyboardDown(e){switch(e.keyCode){case 13:r.died&&this.parent.spawn(r.playerName),r.died=!1;break;case r.KEY_UP_ARROW:case r.KEY_UP:this.parent.set(0,!0);break;case r.KEY_DOWN_ARROW:case r.KEY_DOWN:this.parent.set(1,!0);break;case r.KEY_LEFT_ARROW:case r.KEY_LEFT:this.parent.set(2,!0);break;case r.KEY_RIGHT_ARROW:case r.KEY_RIGHT:this.parent.set(3,!0);break;case r.KEY_MOUSE_0:this.parent.set(4,!0);break;case r.KEY_MOUSE_1:this.parent.set(5,!0);break;case r.KEY_MOUSE_2:this.parent.set(6,!0);break;case r.KEY_LEVEL_UP:this.parent.emit("L");break;case r.KEY_FUCK_YOU:this.parent.emit("0");break;case r.KEY_KILL_YOURSELF:this.parent.emit("K")}if(r.canSkill)switch(e.keyCode){case r.KEY_UPGRADE_ATK:this.parent.talk("x",0);break;case r.KEY_UPGRADE_HTL:this.parent.talk("x",1);break;case r.KEY_UPGRADE_SPD:this.parent.talk("x",2);break;case r.KEY_UPGRADE_STR:this.parent.talk("x",3);break;case r.KEY_UPGRADE_PEN:this.parent.talk("x",4);break;case r.KEY_UPGRADE_DAM:this.parent.talk("x",5);break;case r.KEY_UPGRADE_RLD:this.parent.talk("x",6);break;case r.KEY_UPGRADE_MOB:this.parent.talk("x",7);break;case r.KEY_UPGRADE_RGN:this.parent.talk("x",8);break;case r.KEY_UPGRADE_SHI:this.parent.talk("x",9)}if(!e.repeat){switch(e.keyCode){case r.KEY_AUTO_SPIN:this.parent.talk("t",0);break;case r.KEY_AUTO_FIRE:this.parent.talk("t",1);break;case r.KEY_OVER_RIDE:this.parent.talk("t",2);break;case r.KEY_REVERSE_MOUSE:this.parent.talk("t",3);break;case r.KEY_REVERSE_TANK:this.parent.talk("t",4)}if(r.canUpgrade)switch(e.keyCode){case r.KEY_CHOOSE_1:this.parent.talk("U",0);break;case r.KEY_CHOOSE_2:this.parent.talk("U",1);break;case r.KEY_CHOOSE_3:this.parent.talk("U",2);break;case r.KEY_CHOOSE_4:this.parent.talk("U",3);break;case r.KEY_CHOOSE_5:this.parent.talk("U",4);break;case r.KEY_CHOOSE_6:this.parent.talk("U",5);break;case r.KEY_CHOOSE_7:this.parent.talk("U",6);break;case r.KEY_CHOOSE_8:this.parent.talk("U",7)}}}keyboardUp(e){switch(e.keyCode){case r.KEY_UP_ARROW:case r.KEY_UP:this.parent.set(0,!1);break;case r.KEY_DOWN_ARROW:case r.KEY_DOWN:this.parent.set(1,!1);break;case r.KEY_LEFT_ARROW:case r.KEY_LEFT:this.parent.set(2,!1);break;case r.KEY_RIGHT_ARROW:case r.KEY_RIGHT:this.parent.set(3,!1);break;case r.KEY_MOUSE_0:this.parent.set(4,!1);break;case r.KEY_MOUSE_1:this.parent.set(5,!1);break;case r.KEY_MOUSE_2:this.parent.set(6,!1)}}mouseDown(e){switch(e.button){case 0:let t={x:e.clientX,y:e.clientY},a=r.clickables.stat.check(t);if(-1!==a)this.parent.talk("x",a);else if(-1!==r.clickables.skipUpgrades.check(t))r.clearUpgrades();else{let e=r.clickables.upgrade.check(t);-1!==e?this.parent.talk("U",e):this.parent.set(4,!0)}break;case 1:this.parent.set(5,!0);break;case 2:this.parent.set(6,!0)}}mouseUp(e){switch(e.button){case 0:this.parent.set(4,!1);break;case 1:this.parent.set(5,!1);break;case 2:this.parent.set(6,!1)}}gameInput(e){this.parent.target.x=e.clientX-this.width/2,this.parent.target.y=e.clientY-this.height/2,r.target=this.parent.target,r.statHover=0===r.clickables.hover.check({x:e.clientX,y:e.clientY})}}},function(e,t){t.submitToLocalStorage=(e=>(localStorage.setItem(e+"Value",document.getElementById(e).value),localStorage.setItem(e+"Checked",document.getElementById(e).checked),!1)),t.retrieveFromLocalStorage=(e=>(document.getElementById(e).value=localStorage.getItem(e+"Value"),document.getElementById(e).checked="true"===localStorage.getItem(e+"Checked"),!1)),t.handleLargeNumber=((e,t=!1)=>t&&0==e?"":e<1e3?e.toFixed(0)+"":e<1e6?(e/1e3).toFixed(2)+"k":e<1e9?(e/1e6).toFixed(2)+"m":e<1e12?(e/1e9).toFixed(2)+"b":e<1e15?(e/1e12).toFixed(2)+"t":(e/1e15).toFixed(2)+"q"),t.timeForHumans=(e=>{let t=e%60;e/=60;let a=(e=Math.floor(e))%60;e/=60;let r=(e=Math.floor(e))%24;e/=24;let n="";function i(e,t){e&&(n=n+(""===n?"":", ")+e+" "+t+(e>1?"s":""))}return i(e=Math.floor(e),"day"),i(r,"hour"),i(a,"minute"),i(t,"second"),""===n&&(n="less than a second"),n}),t.addArticle=(e=>/[aeiouAEIOU]/.test(e[0])?"an "+e:"a "+e),t.formatLargeNumber=(e=>e.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,",")),t.pullJSON=((e,t)=>{let a=new XMLHttpRequest,r=("https:"===location.protocol?"https://":"http://")+e+"/"+t+".json";return console.log("Loading JSON from "+r),a.responseType="json",new Promise((e,t)=>{a.open("GET",r),a.onload=(()=>{e(a.response),console.log("JSON load complete.")}),a.onerror=(()=>{t(a.statusText),console.log("JSON load failed."),console.log(a.statusText)}),a.send()})})},function(e,t,a){"use strict";var r=a(0),n=a(3),i={graphical:{screenshotMode:!1,borderChunk:6,barChunk:5,mininumBorderChunk:3,darkBorders:!1,fancyAnimations:!0,colors:"normal",pointy:!0,fontSizeBoost:1,neon:!1},gui:{expectedMaxSkillLevel:9},lag:{unresponsive:!1,memory:60}};let l=(()=>{function e(e){return parseInt(e,16)}return(t,a,r=.5)=>{if(1===r)return a;if(0===r)return t;for(var n="#",i=1;i<=6;i+=2){for(var l=e(a.substr(i,2)),o=e(t.substr(i,2)),s=Math.floor(o+(l-o)*r).toString(16);s.length<2;)s="0"+s;n+=s}return n}})();function o(e){switch(e){case 0:return B.teal;case 1:return B.lgreen;case 2:return B.orange;case 3:return B.yellow;case 4:return B.lavender;case 5:return B.pink;case 6:return B.vlgrey;case 7:return B.lgrey;case 8:return B.guiwhite;case 9:return B.black;case 10:return B.blue;case 11:return B.green;case 12:return B.red;case 13:return B.gold;case 14:return B.purple;case 15:return B.magenta;case 16:return B.grey;case 17:return B.dgrey;case 18:return B.white;case 19:return B.guiblack;case 20:return B.guiyellow;default:return"#FF0000"}}function s(e){let t=i.graphical.neon?B.white:B.black;return i.graphical.darkBorders?t:l(e,t,B.border)}function c(e){switch(e){case"bas1":case"bap1":case"dom1":return B.blue;case"bas2":case"bap2":case"dom2":return B.green;case"bas3":case"bap3":case"dom3":return B.red;case"bas4":case"bap4":case"dom4":return B.pink;case"domx":return B.yellow;default:return B.white}}function d(e,t){i.graphical.neon?(e.fillStyle=s(t),e.strokeStyle=t):(e.fillStyle=t,e.strokeStyle=s(t))}var h=[];function g(e,t=h[e].color){let a=h[e];return{time:0,index:e,x:a.x,y:a.y,vx:0,vy:0,size:a.size,realSize:a.realSize,color:t,render:{status:{getFade:()=>1,getColor:()=>"#FFFFFF",getBlend:()=>0,health:{get:()=>1},shield:{get:()=>1}}},facing:a.facing,shape:a.shape,name:a.name,score:0,tiggle:0,layer:a.layer,guns:{length:a.guns.length,getPositions:()=>Array(a.guns.length).fill(0),update:()=>{}},turrets:a.turrets.map(e=>{let t=g(e.index);return t.realSize=t.realSize/t.size*a.size*e.sizeFactor,t.size=a.size*e.sizeFactor,t.angle=e.angle,t.offset=e.offset,t.direction=e.direction,t.facing=e.direction+e.angle,t})}}r.clickables=(()=>{let e=(()=>{function e(){let e={x:0,y:0,w:0,h:0},t=!1;return{set:(a,r,n,i)=>{e.x=a,e.y=r,e.w=n,e.h=i,t=!0},check:a=>{let r=Math.round(a.x-e.x),n=Math.round(a.y-e.y);return t&&r>=0&&n>=0&&r<=e.w&&n<=e.h},hide:()=>{t=!1}}}return t=>{let a=[];for(let r=0;r<t;r++)a.push(e());return{place:(e,...t)=>{if(e>=a.length)throw console.log(e),console.log(a),new Error("Trying to reference a clickable outside a region!");a[e].set(...t)},hide:()=>{for(let e of a)e.hide()},check:e=>a.findIndex(t=>t.check(e))}}})();return{stat:e(10),upgrade:e(8),hover:e(1),skipUpgrades:e(1)}})(),r.statHover=!1,r.upgradeHover=!1;var u=[],p=[],m=0,f=[],y={latency:0,lag:0,rendertime:0,updatetime:0,lastlag:0,lastrender:0,rendergap:0,lastuplink:0},k=0,b=0,w=0,x={x:(T={id:-1,x:r.screenWidth/2,y:r.screenHeight/2,vx:0,vy:0,renderx:r.screenWidth/2,rendery:r.screenHeight/2,renderv:1,slip:0,view:1,time:0,screenWidth:r.screenWidth,screenHeight:r.screenHeight,target:{x:r.screenWidth/2,y:r.screenHeight/2}}).x,y:T.y},E=[["norm"]],S={getStatNames:e=>{switch(e){case 1:return["Body Damage","Max Health","Bullet Speed","Bullet Health","Bullet Penetration","Bullet Damage","Engine Acceleration","Movement Speed","Shield Regeneration","Shield Capacity"];case 2:return["Body Damage","Max Health","Drone Speed","Drone Health","Drone Penetration","Drone Damage","Respawn Rate","Movement Speed","Shield Regeneration","Shield Capacity"];case 3:return["Body Damage","Max Health","Drone Speed","Drone Health","Drone Penetration","Drone Damage","Max Drone Count","Movement Speed","Shield Regeneration","Shield Capacity"];case 4:return["Body Damage","Max Health","Swarm Speed","Swarm Health","Swarm Penetration","Swarm Damage","Reload","Movement Speed","Shield Regeneration","Shield Capacity"];case 5:return["Body Damage","Max Health","Placement Speed","Trap Health","Trap Penetration","Trap Damage","Reload","Movement Speed","Shield Regeneration","Shield Capacity"];case 6:return["Body Damage","Max Health","Weapon Speed","Weapon Health","Weapon Penetration","Weapon Damage","Reload","Movement Speed","Shield Regeneration","Shield Capacity"];default:return["Body Damage","Max Health","Bullet Speed","Bullet Health","Bullet Penetration","Bullet Damage","Reload","Movement Speed","Shield Regeneration","Shield Capacity"]}},skills:[{amount:0,color:"purple",cap:1,softcap:1},{amount:0,color:"pink",cap:1,softcap:1},{amount:0,color:"blue",cap:1,softcap:1},{amount:0,color:"lgreen",cap:1,softcap:1},{amount:0,color:"red",cap:1,softcap:1},{amount:0,color:"yellow",cap:1,softcap:1},{amount:0,color:"green",cap:1,softcap:1},{amount:0,color:"teal",cap:1,softcap:1},{amount:0,color:"gold",cap:1,softcap:1},{amount:0,color:"orange",cap:1,softcap:1}],points:0,upgrades:[],playerid:-1,__s:(()=>{let e=0,t=0,a=0,r=H(0,10);return{setScore:e=>{e?(r.set(e),t>r.get()&&(a=0,t=0)):(r=H(0,10),a=0)},update:()=>{e=Math.ceil(1.8*Math.pow(a+1,1.8)-2*a+1),r.get()-t>=e&&(t+=e,a+=1)},getProgress:()=>e?Math.min(1,Math.max(0,(r.get()-t)/e)):0,getScore:()=>r.get(),getLevel:()=>a}})(),type:0,fps:0,color:0,accel:0,topspeed:1};r.clearUpgrades=(()=>{S.upgrades=[]});var v=(()=>{let e={};return{get:()=>{let t=[],a=1;for(let r in e){if(!e.hasOwnProperty(r))continue;let n=e[r].publish();t.push(n),n.score>a&&(a=n.score)}return t.sort((e,t)=>t.score-e.score),{data:t,max:a}},remove:t=>{if(void 0===e["_"+t])return console.log("Warning: Asked to removed an unknown leaderboard entry."),-1;delete e["_"+t]},add:t=>{let a=function(e="",t=0,a=0){let r=0,n=H(0,10);return{update:(e,t)=>{r=e,n.set(t)},publish:()=>{let i=h[r];return{image:g(r,a),position:i.position,barcolor:o(t),label:""===e?i.name:e+" - "+i.name,score:n.get()}}}}(t.name,t.barcolor,t.color);a.update(t.index,t.score),e["_"+t.id]=a},update:t=>{if(void 0===e["_"+t.id])return console.log("Warning: Asked to update an unknown leaderboard entry."),-1;e["_"+t.id].update(t.index,t.score)},purge:()=>{e={}}}})(),_=()=>Math.max(r.screenWidth/T.renderv,r.screenHeight/T.renderv/9*16);r.target=x,r.player=T,r.canUpgrade=!1,r.canSkill=!1,r.message="",r.time=0;var M=e=>{e&&r.servers[e]?localStorage.gameMode=e:e=r.servers[r.serverID]?r.serverID:"b"===e?"a":"a"===e?"b":Math.random()<.5?"b":"a",r.serverID=e;let t="b"===e?"a":"a"===e?"b":Math.random()<.5?"b":"a",a=r.servers[e],n=document.getElementById("serverName").firstChild;n.innerHTML=a.name+"&nbsp;&nbsp;&nbsp;";let i=document.createElement("a");i.innerText="Switch",i.href="#"+t,i.onclick=(()=>{M(t),localStorage.gameMode=t}),n.appendChild(i)};let U;window.onload=(()=>{M(location.hash.slice(1)||localStorage.gameMode),n.retrieveFromLocalStorage("playerNameInput"),n.retrieveFromLocalStorage("optScreenshotMode"),n.retrieveFromLocalStorage("optPredictive"),n.retrieveFromLocalStorage("optFancy"),n.retrieveFromLocalStorage("optColors"),n.retrieveFromLocalStorage("optNoPointy"),n.retrieveFromLocalStorage("optBorders"),""===document.getElementById("optColors").value&&(document.getElementById("optColors").value="normal"),""===document.getElementById("optBorders").value&&(document.getElementById("optBorders").value="normal");let e,t,a=document.getElementById("patchNotesIFrame");U=setInterval(()=>{(e||(e=a.contentDocument&&a.contentDocument.body))&&(t||(t=e.innerHTML.trim()),e.innerHTML.trim()!==t&&(e.innerHTML=t))},5),document.getElementById("startButton").onclick=(()=>z()),document.onkeydown=(e=>{(e.which||e.keyCode)!==r.KEY_ENTER||!r.dead&&r.gameStart||z()}),window.addEventListener("resize",()=>{T.screenWidth=A.cv.width=r.screenWidth=window.innerWidth,T.screenHeight=A.cv.height=r.screenHeight=window.innerHeight})});var A=new(a(2)),K=A.cv.getContext("2d"),C=document.createElement("canvas").getContext("2d");function H(e,t,a=3){let r=Date.now(),n=e,i=e;return{set:t=>{e!==t&&(i=n,e=t,r=Date.now())},get:()=>{let l=(Date.now()-r)/1e3;return n=l<t?i+(e-i)*Math.pow(l/t,1/a):e}}}var R=[],I=0,W=0,P=(()=>{let e=[];return{get:()=>{return e.length?e.reduce(function(e,t){return e+t})/e.length:0},add:t=>{e.push(t),e.length>i.lag.memory&&e.splice(0,1)}}})(),Y=()=>Date.now()-I-W,T={vx:0,vy:0,lastvx:0,lastvy:0,renderx:T.x||0,rendery:T.y||0,lastx:T.x||0,lasty:T.y||0,target:A.target,name:"",lastUpdate:0,time:0},O=(()=>{let e=0,t=0,a=0,n=0;return{reset:()=>{e=0,t=0},get:()=>i.lag.unresponsive?{x:0,y:0}:{x:e,y:t},iterate:i=>{if(r.died||r.gameStart)return 0;let l=S.accel/S.topSpeed,o=Math.sqrt(i.x*i.x+i.y*i.y);a+=S.accel*i.x/o,n+=S.accel*i.y/o;let s=Math.sqrt(a*a+n*n);if(s>0&&l){let e=s/(l/0+1);a=e*a/s,n=e*n/s}e+=a,t+=n}}})();const F=(()=>{window.WebSocket=window.WebSocket||window.MozWebSocket;const e=a(1),t=(()=>{const e=(()=>{let e=0,t=[];return{next:()=>{if(e>=t.length)throw console.log(t),new Error("Trying to crawl past the end of the provided data!");return t[e++]},set:a=>{t=a,e=0}}})();return{begin:t=>e.set(t),data:(()=>{const t=(()=>{const a=(()=>{function e(e){e.isUpdated=!0,(e.motion||e.position)&&(e.motion-=.2*e.position,e.position+=e.motion,e.position<0&&(e.position=0,e.motion=-e.motion),e.motion>0&&(e.motion*=.5))}return t=>{let a=[];for(let e=0;e<t;e++)a.push({motion:0,position:0,isUpdated:!0});return{getPositions:()=>a.map(e=>e.position),update:()=>a.forEach(e),fire:(e,t)=>{a[e].isUpdated&&(a[e].motion+=Math.sqrt(t)/20),a[e].isUpdated=!1},length:a.length}}})();return(r={})=>{let n=null==r.facing,l=e.next();if(1&l)r.facing=e.next(),r.layer=e.next();else{r.interval=y.rendergap,r.id=e.next();let t=u.findIndex(e=>e.id===r.id);if(-1!==t&&(r=u.splice(t,1)[0]),(n=-1===t)||(r.render.draws=!0,r.render.lastx=r.x,r.render.lasty=r.y,r.render.lastvx=r.vx,r.render.lastvy=r.vy,r.render.lastf=r.facing,r.render.lastRender=T.time),r.index=e.next(),r.x=e.next(),r.y=e.next(),r.vx=e.next(),r.vy=e.next(),r.size=e.next(),r.facing=e.next(),r.vfacing=e.next(),r.twiggle=e.next(),r.layer=e.next(),r.color=e.next(),n)r.health=e.next()/255,r.shield=e.next()/255;else{let t=r.health,a=r.shield;r.health=e.next()/255,r.shield=e.next()/255,r.health<t||r.shield<a?r.render.status.set("injured"):1!==r.render.status.getFade()&&r.render.status.set("normal")}r.drawsHealth=!!(2&l),r.alpha=e.next()/255,4&l&&(r.name=e.next(),r.score=e.next()),r.nameplate=4&l,n&&(r.render={draws:!1,expandsWithDeath:r.drawsHealth,lastRender:T.time,x:r.x,y:r.y,lastx:r.x-y.rendergap*i.roomSpeed*(1e3/30)*r.vx,lasty:r.y-y.rendergap*i.roomSpeed*(1e3/30)*r.vy,lastvx:r.vx,lastvy:r.vy,lastf:r.facing,f:r.facing,h:r.health,s:r.shield,interval:y.rendergap,slip:0,status:function(){let e="normal",t=Y();return{set:a=>{a===e&&"injured"!==e||("dying"!==e&&(t=Y()),e=a)},getFade:()=>"dying"===e||"killed"===e?1-Math.min(1,(Y()-t)/300):1,getColor:()=>"#FFFFFF",getBlend:()=>{let a="normal"===e||"dying"===e?0:1-Math.min(1,(Y()-t)/80);return Y()-t>500&&"injured"===e&&(e="normal"),a}}}(),health:H(r.health,.5,5),shield:H(r.shield,.5,5)}),r.render.health.set(r.health),r.render.shield.set(r.shield),n||r.oldIndex===r.index||(n=!0),r.oldIndex=r.index}let o=e.next();if(n)r.guns=a(o);else if(o!==r.guns.length)throw new Error("Mismatch between data gun number and remembered gun number!");for(let t=0;t<o;t++){let a=e.next(),n=e.next();a>T.lastUpdate-y.rendergap&&r.guns.fire(t,n)}let s=e.next();if(s){}if(n){r.turrets=[];for(let e=0;e<s;e++)r.turrets.push(t())}else{if(r.turrets.length!==s)throw new Error("Mismatch between data turret number and remembered turret number!");r.turrets.forEach(t)}return r}})();return()=>{let a=[];for(let r=0,n=e.next();r<n;r++)a.push(t());u.forEach(e=>{e.render.status.set(1===e.health?"dying":"killed"),0!==e.render.status.getFade()&&function(e,t,a,n=!1){let l=_();return a+=i.graphical.borderChunk,n?(l*=2,e>-r.screenWidth/l-a&&e<r.screenWidth/l+a&&t>-r.screenHeight/l-a&&t<r.screenHeight/l+a):e>-a&&e<r.screenWidth/l+a&&t>-a&&t<r.screenHeight/l+a}(e.render.x-T.renderx,e.render.y-T.rendery,e.size,!0)&&a.push(e)}),(u=a).sort((e,t)=>{let a=e.layer-t.layer;return a||(a=t.id-e.id),a})}})(),gui:()=>{let t=e.next(),a=256&t,r=128&t,n=64&t,i=32&t,l=16&t,o=8&t,s=4&t,c=2&t;if(1&t&&(S.fps=e.next()),c&&(S.type=e.next(),S.color=e.next(),S.playerid=e.next()),s&&S.__s.setScore(e.next()),o&&(S.points=e.next()),l){S.upgrades=[];for(let t=0,a=e.next();t<a;t++)S.upgrades.push(e.next())}if(i)for(let t=9;t>=0;t--)S.skills[t].name=e.next(),S.skills[t].cap=e.next(),S.skills[t].softcap=e.next();if(n){let t=parseInt(e.next(),36).toString(16);t="0000000000".substr(t.length)+t,S.skills[0].amount=parseInt(t.slice(0,1),16),S.skills[1].amount=parseInt(t.slice(1,2),16),S.skills[2].amount=parseInt(t.slice(2,3),16),S.skills[3].amount=parseInt(t.slice(3,4),16),S.skills[4].amount=parseInt(t.slice(4,5),16),S.skills[5].amount=parseInt(t.slice(5,6),16),S.skills[6].amount=parseInt(t.slice(6,7),16),S.skills[7].amount=parseInt(t.slice(7,8),16),S.skills[8].amount=parseInt(t.slice(8,9),16),S.skills[9].amount=parseInt(t.slice(9,10),16)}r&&(S.accel=e.next()),a&&(S.topspeed=e.next())},minimap:(()=>{let t=(()=>{return()=>{let t=e.next(),a=e.next()*r.gameWidth/255,n=e.next()*r.gameHeight/255,i=e.next();switch(t){case-1:{let e=p.findIndex(e=>(D=e,L=[a,n,i],D[0]===L[0]&&D[1]===L[1]&&D[2]===L[2]));-1===e?console.log("Warning: Remove request for a minimap node we were not aware of."):p.splice(e,1)}break;case 1:p.push([a,n,i]);break;default:console.log("Unknown minimap update request.")}}})();return()=>{for(let a=0,r=e.next();a<r;a++)t()}})(),leaderboard:()=>{let t=!1,a=e.next();if(-1===a)v.purge();else for(let t=0,r=a;t<r;t++)v.remove(e.next());for(let a=0,r=e.next();a<r;a++){let a=e.next();if(a<0){let t={id:-a,score:e.next(),index:e.next(),name:e.next(),color:e.next(),barcolor:e.next()};v.add(t)}else{-1===v.update({id:a,score:e.next(),index:e.next()})&&(t=!0)}}return t}}})();return()=>{n.pullJSON(r.servers[r.serverID].at,"mockups").then(e=>h=e);let a=new WebSocket(("https:"===location.protocol?"wss://":"ws://")+r.servers[r.serverID].at+"/");return a.binaryType="arraybuffer",a.open=!1,a.cmd=(()=>{let e=!1,t=[!1,!1,!1,!1,!1,!1,!1,!1];return{set:(a,r)=>{t[a]!==r&&(t[a]=r,e=!0)},talk:()=>{e=!1;let r=0;for(let e=0;e<8;e++)t[e]&&(r+=Math.pow(2,e));let n=_();a.talk("C",Math.round(A.target.x/n),Math.round(A.target.y/n),r)},check:()=>e,getMotion:()=>({x:t[3]-t[2],y:t[1]-t[0]})}})(),a.talk=((...t)=>{if(!a.open)return 1;a.send(e.encode(t))}),a.onopen=function(){a.open=!0,r.message="",r.playerKey?a.talk("k",r.playerKey):a.talk("k"),console.log("Token submitted to the server for validation."),a.ping=(e=>{a.talk("p",e)});let e=()=>{document.hasFocus()?(a.cmd.check()&&a.cmd.talk(),a.commandCycle=setTimeout(e)):a.commandCycle=setTimeout(e,1e3)};e()},a.onmessage=function(n){let l=e.decode(n.data);if(-1===l)throw new Error("Malformed packet.");switch(l.splice(0,1)[0]){case"w":l[0]?(console.log("The server has welcomed us to the game room. Sending spawn request."),a.talk("s",r.playerName,1),r.message=""):(console.log("The server has rejected us."),l[1]&&(r.message=l[1]));break;case"R":r.gameWidth=l[0],r.gameHeight=l[1],E=JSON.parse(l[2]),W=JSON.parse(l[3]),i.roomSpeed=l[4],console.log("Room data recieved. Commencing syncing process."),a.talk("S",Y());break;case"r":r.gameWidth=l[0],r.gameHeight=l[1],E=JSON.parse(l[2]),console.log("Room data reset.");break;case"e":new Function("$",l[0])(function(e){a.talk("T",e)});break;case"c":T.x=l[0],T.y=l[1],T.view=l[2],T.renderx=T.x,T.rendery=T.y,T.renderv=T.view,console.log("Camera moved!");break;case"S":{let e=l[0],t=l[1],n=(Y()-e)/2,i=Y()-n-t;if(R.push({delta:i,latency:n}),R.length<10)setTimeout(()=>{a.talk("S",Y())},10),r.message="Syncing clocks, please do not tab away. "+R.length+"/10...";else{R.sort((e,t)=>e.latency-t.latency);let e=R[Math.floor(R.length/2)].latency,t=0,a=0,n=0;R.forEach(a=>{t+=Math.pow(a.latency-e,2)}),t=Math.sqrt(t/R.length),R.forEach(r=>{Math.abs(r.latency-e)<t&&(a+=r.delta,n++)}),I=Math.round(a/n),console.log(R),console.log("Syncing complete, calculated clock difference "+I+"ms. Beginning game."),r.gameStart=!0,r.message=""}}break;case"m":f.push({text:l[0],status:2,alpha:0,time:Date.now()});break;case"u":{let e=l[0],n=l[1],i=l[2],o=l[3],s=l[4],c=l[5],d=l.slice(6);e>T.lastUpdate?(P.add(Y()-e),T.time=e+P.get(),y.rendergap=e-T.lastUpdate,y.rendergap<=0&&console.log("yo some bullshit is up wtf"),T.lastUpdate=e,t.begin(d),t.gui(),t.data(),T.lastx=T.x,T.lasty=T.y,T.lastvx=T.vx,T.lastvy=T.vy,T.x=n,T.y=i,T.vx=r.died?0:s,T.vy=r.died?0:c,isNaN(T.renderx)&&(T.renderx=T.x),isNaN(T.rendery)&&(T.rendery=T.y),O.reset(),T.view=o,T.renderv||(T.renderv=2e3),y.lastlag=y.lag,y.lastuplink=Y()):console.log("Old data! Last given time: "+T.time+"; offered packet timestamp: "+e+"."),a.talk("d",Math.max(T.lastUpdate,e)),a.cmd.talk(),w++}break;case"b":t.begin(l),t.minimap(),t.leaderboard()&&a.talk("z");break;case"p":y.latency=r.time-l[0];break;case"F":r.finalScore=H(0,4),r.finalScore.set(l[0]),r.finalLifetime=H(0,5),r.finalLifetime.set(l[1]),r.finalKills=[H(0,3),H(0,4.5),H(0,2.5)],r.finalKills[0].set(l[2]),r.finalKills[1].set(l[3]),r.finalKills[2].set(l[4]),r.finalKillers=[];for(let e=0;e<l[5];e++)r.finalKillers.push(l[6+e]);r.died=!0;case"K":r.isInGame=!1;break;default:throw new Error("Unknown message index.")}},a.onclose=function(){a.open=!1,r.disconnected=!0,r.isInGame=!1,console.log("Socket closed."),clearInterval(a.commandCycle)},a.onerror=function(e){console.log("WebSocket error: "+e),r.message="Socket error. Maybe another server will work.",r.isInGame=!1},a}})();var D,L,B={},N={};function z(){switch(n.submitToLocalStorage("optScreenshotMode"),i.graphical.screenshotMode=document.getElementById("optScreenshotMode").checked,n.submitToLocalStorage("optFancy"),i.graphical.pointy=!document.getElementById("optNoPointy").checked,n.submitToLocalStorage("optNoPointy"),i.graphical.fancyAnimations=!document.getElementById("optFancy").checked,n.submitToLocalStorage("optPredictive"),i.lag.unresponsive=document.getElementById("optPredictive").checked,n.submitToLocalStorage("optBorders"),document.getElementById("optBorders").value){case"normal":i.graphical.darkBorders=i.graphical.neon=!1;break;case"dark":i.graphical.darkBorders=!0,i.graphical.neon=!1;break;case"glass":i.graphical.darkBorders=!1,i.graphical.neon=!0;break;case"neon":i.graphical.darkBorders=i.graphical.neon=!0}n.submitToLocalStorage("optColors");let e=document.getElementById("optColors").value;B=N[""===e?"normal":e]||N.normal;let t=document.getElementById("playerNameInput");n.submitToLocalStorage("playerNameInput"),r.playerName=T.name=t.value,r.playerKey=localStorage.password,r.screenWidth=window.innerWidth,r.screenHeight=window.innerHeight,document.getElementById("startMenuWrapper").style.top="-500px",document.getElementById("gameAreaWrapper").style.opacity=1,r.socket||(r.socket=F()),r.animLoopHandle||oe(),A.socket=r.socket,p=[],clearInterval(U),setInterval(()=>O.iterate(r.socket.cmd.getMotion()),1e3/30),document.getElementById("gameCanvas").focus(),r.isInGame=!0}function G(e,t){K.fillStyle=e,K.globalAlpha=t,K.fillRect(0,0,r.screenWidth,r.screenHeight),K.globalAlpha=1}n.pullJSON("arras.surge.sh","color").then(e=>{B=(N=e).normal});const j=(()=>{let e=document.createElement("canvas").getContext("2d");if(e.measureText){if(e.measureText("test").emHeightAscent)return(t,a,r=!1)=>{a+=i.graphical.fontSizeBoost,e.font="bold "+a+"px Ubuntu";let n=e.measureText(t);return r?{width:n.width,height:n.emHeightAscent}:n.width};console.log("Using semi mode!");let t=document.createElement("div");return t.style.padding="0",t.style.margin="0",t.style.position="absolute",t.style.visibility="hidden",document.body.appendChild(t),(a,r,n=!1)=>(r+=i.graphical.fontSizeBoost,n?(t.style.font="bold "+r+"px Ubuntu",t.innerText=a,{width:t.clientWidth,height:t.clientHeight}):(e.font="bold "+r+"px Ubuntu",e.measureText(a).width))}console.log("Using full mode!");let t=document.createElement("div");return t.style.padding="0",t.style.margin="0",t.style.position="absolute",t.style.visibility="hidden",document.body.appendChild(t),(e,a,r=!1)=>(a+=i.graphical.fontSizeBoost,t.style.font="bold "+a+"px Ubuntu",t.innerText=e,r?{width:t.clientWidth,height:t.clientHeight}:t.clientWidth)})(),q=(()=>{let e=(e=null)=>{let t=!0;return{update:a=>{let r=!1;if(null==e)r=!0;else switch(typeof a!=typeof e&&(r=!0),typeof a){case"number":case"string":a!==e&&(r=!0);break;case"object":if(Array.isArray(a)){if(a.length!==e.length)r=!0;else for(let t=0,n=a.length;t<n;t++)a[t]!==e[t]&&(r=!0);break}default:throw console.log(a),new Error("Unsupported type for a floppyvar!")}r&&(t=!0,e=a)},publish:()=>e,check:()=>!!t&&(t=!1,!0)}};return()=>{let t=document.createElement("canvas").getContext("2d");t.imageSmoothingEnabled=!1;let a=[e(""),e(0),e(0),e(1),e("#FF0000"),e("left")],r=(a.map(e=>e.publish()),0),n=0;return{draw:(e,l,o,s,c,d="left",h=!1,g=1)=>{if(s+=i.graphical.fontSizeBoost,a[0].update(e),a[1].update(l),a[2].update(o),a[3].update(s),a[4].update(c),a[5].update(d),a.some(e=>e.check())){let a=Math.max(3,s/5),l=j(e,s-i.graphical.fontSizeBoost,!0);switch(t.canvas.height=l.height+2*a,t.canvas.width=l.width+2*a,d){case"left":r=a;break;case"center":r=t.canvas.width/2;break;case"right":r=t.canvas.width-a}n=t.canvas.height/2,t.lineWidth=a,t.font="bold "+s+"px Ubuntu",t.textAlign=d,t.textBaseline="middle",t.strokeStyle=B.black,t.fillStyle=c,t.lineCap="round",t.lineJoin="round",t.strokeText(e,r,n),t.fillText(e,r,n)}K.drawImage(t.canvas,l-r,o-n*(h?1.05:1.5))}}}})();function J(e,t,a,r,n=!1){n?K.strokeRect(e,t,a,r):K.fillRect(e,t,a,r)}function V(e,t,a,r=!1){K.beginPath(),K.arc(e,t,a,0,2*Math.PI,!1),K.closePath(),r?K.stroke():K.fill()}function X(e,t,a,r){K.beginPath(),K.lineTo(Math.round(e)+.5,Math.round(t)+.5),K.lineTo(Math.round(a)+.5,Math.round(r)+.5),K.closePath(),K.stroke()}function $(e,t,a,r,n){K.beginPath(),K.lineTo(e,a),K.lineTo(t,a),K.lineWidth=r,K.strokeStyle=n,K.closePath(),K.stroke()}const Z=(()=>{function e(e,t,a,r,n,i,l){let o=[];o=i>0?[n*i,n]:[n,-n*i];let s=[Math.atan2(o[0],r),Math.atan2(o[1],r)],c=[Math.sqrt(r*r+o[0]*o[0]),Math.sqrt(r*r+o[1]*o[1])];e.beginPath(),e.lineTo(t+c[0]*Math.cos(l+s[0]),a+c[0]*Math.sin(l+s[0])),e.lineTo(t+c[1]*Math.cos(l+Math.PI-s[1]),a+c[1]*Math.sin(l+Math.PI-s[1])),e.lineTo(t+c[1]*Math.cos(l+Math.PI+s[1]),a+c[1]*Math.sin(l+Math.PI+s[1])),e.lineTo(t+c[0]*Math.cos(l-s[0]),a+c[0]*Math.sin(l-s[0])),e.closePath(),e.stroke(),e.fill()}return(t,a,r,n,s=1,c=1,g=0,u=!1,p=!1,m=!1,f=r.render)=>{let y=p||K,k=m?1:f.status.getFade(),b=c*n*r.size,w=h[r.index],x=t,E=a,S=!1===m?r:m;if(0!==k&&0!==s){if(f.expandsWithDeath&&(b*=1+.5*(1-k)),!i.graphical.fancyAnimations||p==C||1===k&&1===s||((y=C).canvas.width=y.canvas.height=b*w.position.axis+20*n,x=y.canvas.width/2-b*w.position.axis*w.position.middle.x*Math.cos(g)/4,E=y.canvas.height/2-b*w.position.axis*w.position.middle.x*Math.sin(g)/4,p=!1),"object"!=typeof y&&(y=K),y.lineCap="round",y.lineJoin="round",S.turrets.length!==w.turrets.length)throw new Error("Mismatch turret number with mockup.");for(let e=0;e<w.turrets.length;e++){let t=w.turrets[e];if(0===t.layer){let a=t.direction+t.angle+g,r=t.offset*b;Z(x+r*Math.cos(a),E+r*Math.sin(a),t,n,s,b/n/t.size*t.sizeFactor,S.turrets[e].facing+u*g,u,y,S.turrets[e],f)}}if(S.guns.update(),y.lineWidth=Math.max(i.graphical.mininumBorderChunk,n*i.graphical.borderChunk),d(y,l(B.grey,f.status.getColor(),f.status.getBlend())),S.guns.length!==w.guns.length)throw new Error("Mismatch gun number with mockup.");{let t=S.guns.getPositions();for(let a=0;a<w.guns.length;a++){let r=w.guns[a],n=t[a]/(1===r.aspect?2:1);e(y,x+b*(r.offset*Math.cos(r.direction+r.angle+g)+(r.length/2-n)*Math.cos(r.angle+g)),E+b*(r.offset*Math.sin(r.direction+r.angle+g)+(r.length/2-n)*Math.sin(r.angle+g)),b*(r.length/2-(1===r.aspect?2*n:0)),b*r.width/2,r.aspect,r.angle+g)}}if(y.globalAlpha=1,d(y,l(o(r.color),f.status.getColor(),f.status.getBlend())),function(e,t,a,r,n,l=0,o=!0){if(l+=n%2?0:Math.PI/n,e.beginPath(),n){if(n<0){i.graphical.pointy&&(e.lineJoin="miter");let o=1-6/n/n;n=-n,e.moveTo(t+r*Math.cos(l),a+r*Math.sin(l));for(let i=0;i<n;i++){var s=(i+1)/n*2*Math.PI,c=(i+.5)/n*2*Math.PI,d={x:t+r*o*Math.cos(c+l),y:a+r*o*Math.sin(c+l)},h={x:t+r*Math.cos(s+l),y:a+r*Math.sin(s+l)};e.quadraticCurveTo(d.x,d.y,h.x,h.y)}}else if(n>0)for(let i=0;i<n;i++){let o=i/n*2*Math.PI,s=t+r*Math.cos(o+l),c=a+r*Math.sin(o+l);e.lineTo(s,c)}}else e.arc(t,a,r,0,2*Math.PI);e.closePath(),e.stroke(),o&&e.fill(),e.lineJoin="round"}(y,x,E,b/w.size*w.realSize,w.shape,g),S.turrets.length!==w.turrets.length)throw new Error("Mismatch turret number with mockup.");for(let e=0;e<w.turrets.length;e++){let t=w.turrets[e];if(1===t.layer){let a=t.direction+t.angle+g,r=t.offset*b;Z(x+r*Math.cos(a),E+r*Math.sin(a),t,n,s,b/n/t.size*t.sizeFactor,S.turrets[e].facing+u*g,u,y,S.turrets[e],f)}}0==p&&y!=K&&(K.save(),K.globalAlpha=s*k,K.drawImage(y.canvas,t-x,a-E),K.restore())}}})();window.requestAnimFrame=(()=>window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)})();const Q=(()=>{const e=H(0,.7,1.5),t=H(0,2,3);function a(){var e=[];return(t,a,r,n,i,l)=>{for(e.push(t);e.length>n;)e.splice(0,1);let o=Math.min(...e),s=Math.max(...e),c=s-o;s>0&&o<0&&$(a,a+n,r+i*s/c,2,B.guiwhite),K.beginPath(),K.moveTo(a,r+i*(s-e[0])/c);for(let t=1;t<e.length;t++)K.lineTo(a+t,r+i*(s-e[t])/c);K.lineWidth=1,K.strokeStyle=l,K.stroke()}}const s=(()=>{return()=>{let e=0,t=0,a=0;return{set:(r=T.time,n=y.rendergap)=>{(e=Math.max(Y()-r-80,-n))>150&&e<1e3&&(e=150),e>1e3&&(e=1e6*Math.sin(e/1e3-1)/e+1e3),t=e/n,a=30*i.roomSpeed*e/1e3},predict:(a,r,n,i)=>e>=0?(r=r)+(r-a)*t:function(e,t,a,r,n,i){let l=Math.cos((1+i)*Math.PI);return.5*(((1+i)*a+e)*(l+1)+(-i*r+t)*(1-l))}(a,r,n,i,0,t),predictFacing:(e,a)=>e+(1+t)*(te=a-e+Math.PI,ae=2*Math.PI,(te%ae+ae)%ae-Math.PI),getPrediction:()=>e}}})(),d=a(),k=a(),w=a(),_=(()=>{let e=[];for(let t=0;t<2*i.gui.expectedMaxSkillLevel;t++)e.push((ee=t/i.gui.expectedMaxSkillLevel,Math.log(4*ee+1)/Math.log(5)));return t=>e[t]})(),M={skillNames:[q(),q(),q(),q(),q(),q(),q(),q(),q(),q()],skillKeys:[q(),q(),q(),q(),q(),q(),q(),q(),q(),q()],skillValues:[q(),q(),q(),q(),q(),q(),q(),q(),q(),q()],skillPoints:q(),score:q(),name:q(),class:q(),debug:[q(),q(),q(),q(),q(),q(),q()],lbtitle:q(),leaderboard:[q(),q(),q(),q(),q(),q(),q(),q(),q(),q()],upgradeNames:[q(),q(),q(),q(),q(),q(),q(),q()],upgradeKeys:[q(),q(),q(),q(),q(),q(),q(),q()],skipUpgrades:q()};return a=>{let U,A,C=0;b++;{let e=s();e.set();let t={x:0,y:0};C=e.getPrediction(),T.renderx=e.predict(T.lastx,T.x,T.lastvx,T.vx)+t.x,T.rendery=e.predict(T.lasty,T.y,T.lastvy,T.vy)+t.y,U=a*T.renderx,A=a*T.rendery}{G(B.white,1),G(B.guiblack,.1);let e=E[0].length,t=E.length;for(let n=0;n<t;n++){let l=E[n];for(let o=0;o<e;o++){let s=Math.max(0,a*o*r.gameWidth/e-U+r.screenWidth/2),d=Math.max(0,a*n*r.gameHeight/t-A+r.screenHeight/2),h=Math.min(r.screenWidth,a*(o+1)*r.gameWidth/e-U+r.screenWidth/2),g=Math.min(r.screenHeight,a*(n+1)*r.gameHeight/t-A+r.screenHeight/2);K.globalAlpha=1,K.fillStyle=i.graphical.screenshotMode?B.guiwhite:B.white,K.fillRect(s,d,h-s,g-d),K.globalAlpha=.3,K.fillStyle=i.graphical.screenshotMode?B.guiwhite:c(l[o]),K.fillRect(s,d,h-s,g-d)}}K.lineWidth=1,K.strokeStyle=i.graphical.screenshotMode?B.guiwhite:B.guiblack,K.globalAlpha=.04,K.beginPath();let n=30*a;for(let e=(r.screenWidth/2-U)%n;e<r.screenWidth;e+=n)K.moveTo(e,0),K.lineTo(e,r.screenHeight);for(let e=(r.screenHeight/2-A)%n;e<r.screenHeight;e+=n)K.moveTo(0,e),K.lineTo(r.screenWidth,e);K.stroke(),K.globalAlpha=1}u.forEach(function(e){if(!e.render.draws)return 1;let t=s();1===e.render.status.getFade()?t.set():t.set(e.render.lastRender,e.render.interval),e.render.x=t.predict(e.render.lastx,e.x,e.render.lastvx,e.vx),e.render.y=t.predict(e.render.lasty,e.y,e.render.lastvy,e.vy),e.render.f=e.id===S.playerid&&1!==e.twiggle?Math.atan2(x.y,x.x)+(e.twiggle?Math.PI:0):t.predictFacing(e.render.lastf,e.facing);let n=e.id===S.playerid?0:a*e.render.x-U,i=e.id===S.playerid?0:a*e.render.y-A;n+=r.screenWidth/2,i+=r.screenHeight/2,Z(n,i,e,a,e.alpha,1.1,e.render.f,!1,!0)}),i.graphical.screenshotMode||u.forEach(function(e){let t=e.id===S.playerid?0:a*e.render.x-U,l=e.id===S.playerid?0:a*e.render.y-A;!function(e,t,a,r,l){K.globalAlpha=Math.pow(a.render.status.getFade(),2);let o=a.size*r,s=h[a.index],c=o/s.size*s.realSize;if(a.drawsHealth){let r=a.render.health.get(),n=a.render.shield.get();if(r<1||n<1){let a=t+1.1*c+15;K.globalAlpha=l*l,$(e-o,e+o,a,3+i.graphical.barChunk,B.black),$(e-o,e-o+2*o*r,a,3,B.lgreen),n&&(K.globalAlpha*=.3+.3*n,$(e-o,e-o+2*o*n,a,3,B.teal)),K.globalAlpha=1}}if(a.nameplate&&a.id!==S.playerid){null==a.render.textobjs&&(a.render.textobjs=[q(),q()]);var d=a.name,g=B.guiwhite;8203===d.charCodeAt(0)&&(g=B.guiyellow,d=d.slice(1)),K.globalAlpha=l,a.render.textobjs[0].draw(d,e,t-c-30,16,g,"center"),a.render.textobjs[1].draw(n.handleLargeNumber(a.score,!0),e,t-c-16,8,g,"center"),K.globalAlpha=1}}(t+=r.screenWidth/2,l+=r.screenHeight/2,e,a,e.alpha)});let H=200/Math.max(r.screenWidth,16*r.screenHeight/9);S.__s.update();let R=v.get(),I=R.max;{let e=4,t=18,a=r.screenWidth/2,n=20;for(let r=f.length-1;r>=0;r--){let i=f[r],l=i.text;null==i.textobj&&(i.textobj=q()),null==i.len&&(i.len=j(l,t-4)),K.globalAlpha=.5*i.alpha,$(a-i.len/2,a+i.len/2,n+t/2,t,B.black),K.globalAlpha=Math.min(1,i.alpha),i.textobj.draw(l,a,n+t/2,t-4,B.guiwhite,"center",!0),n+=e+t,i.status>1&&(n-=(e+t)*(1-Math.sqrt(i.alpha))),i.status>1?(i.status-=.05,i.alpha+=.05):0===r&&(f.length>5||Date.now()-i.time>1e4)&&(i.status-=.05,i.alpha-=.05,i.alpha<=0&&f.splice(0,1))}K.globalAlpha=1}{r.canSkill=!!S.points,e.set(0+(r.canSkill||r.died||r.statHover)),r.clickables.stat.hide();let t=4,a=15,n=35,l=H*r.screenWidth,o=l,s=-20-2*l+e.get()*(40+2*l),c=r.screenHeight-20-a,d=11,g=S.getStatNames(h[S.type].statnames||-1);S.skills.forEach(function(e){let h=g[--d-1],u=e.amount,p=B[e.color],m=e.softcap,f=e.cap;if(m){l=o;let e=i.gui.expectedMaxSkillLevel,g=m<f;if(m>e&&(e=m),$(s+a/2,s-a/2+l*_(m),c+a/2,a-3+i.graphical.barChunk,B.black),$(s+a/2,s+a/2+(l-n)*_(m),c+a/2,a-3,B.grey),$(s+a/2,s+a/2+(l-n)*_(u),c+a/2,a-3.5,p),g){K.lineWidth=1,K.strokeStyle=B.grey;for(let t=m+1;t<e;t++)X(s+(l-n)*_(t),c+1.5,s+(l-n)*_(t),c-3+a)}K.strokeStyle=B.black,K.lineWidth=1;for(let e=1;e<u+1;e++)X(s+(l-n)*_(e),c+1.5,s+(l-n)*_(e),c-3+a);l=o*_(e);let y=u==f?p:!S.points||m!==f&&u==m?B.grey:B.guiwhite;M.skillNames[d-1].draw(h,Math.round(s+l/2)+.5,c+a/2,a-5,y,"center",!0),M.skillKeys[d-1].draw("["+d%10+"]",Math.round(s+l-.25*a)-1.5,c+a/2,a-5,y,"right",!0),y===B.guiwhite&&r.clickables.stat.place(d-1,s,c,l,a),u&&M.skillValues[d-1].draw(y===p?"MAX":"+"+u,Math.round(s+l+4)+.5,c+a/2,a-5,p,"left",!0),c-=a+t}}),r.clickables.hover.place(0,0,c,.8*l,.8*(r.screenHeight-c)),0!==S.points&&M.skillPoints.draw("x"+S.points,Math.round(s+l-2)+.5,Math.round(c+a-4)+.5,20,B.guiwhite,"right")}{let e=4,t=1.65*H*r.screenWidth,a=25,l=(r.screenWidth-t)/2,o=r.screenHeight-20-a;K.lineWidth=1,$(l,l+t,o+a/2,a-3+i.graphical.barChunk,B.black),$(l,l+t,o+a/2,a-3,B.grey),$(l,l+t*S.__s.getProgress(),o+a/2,a-3.5,B.gold),M.class.draw("Level "+S.__s.getLevel()+" "+h[S.type].name,l+t/2,o+a/2,a-4,B.guiwhite,"center",!0),$(l+.1*t,l+.9*t,(o-=(a=14)+e)+a/2,a-3+i.graphical.barChunk,B.black),$(l+.1*t,l+.9*t,o+a/2,a-3,B.grey),$(l+.1*t,l+t*(.1+.8*(I?Math.min(1,S.__s.getScore()/I):1)),o+a/2,a-3.5,B.green),M.score.draw("Score: "+n.formatLargeNumber(S.__s.getScore()),l+t/2,o+a/2,a-2,B.guiwhite,"center",!0),K.lineWidth=4,M.name.draw(T.name,Math.round(l+t/2)+.5,Math.round(o-10-e)+.5,32,B.guiwhite,"center")}{let e=H*r.screenWidth,t=e/r.gameWidth*r.gameHeight,a=r.screenWidth-e-20,n=r.screenHeight-t-20;K.globalAlpha=.6;let i=E[0].length,s=E.length,h=e/i,g=t/s;for(let e=0;e<s;e++){let t=E[e];for(let r=0;r<i;r++)K.fillStyle=c(t[r]),J(a+r*h,n+e*g,h,g)}K.globalAlpha=.3,K.fillStyle=B.grey,J(a,n,e,t);for(let t of p)17===t[2]?(K.fillStyle=l(o(t[2]),B.black,.5),K.globalAlpha=.6,V(a+t[0]/r.gameWidth*e,n+t[1]/r.gameHeight*e,.8)):(K.fillStyle=l(o(t[2]),B.black,.5),K.globalAlpha=1,V(a+t[0]/r.gameWidth*e,n+t[1]/r.gameWidth*e,2));K.globalAlpha=1,K.lineWidth=1,K.strokeStyle=B.black,V(a+T.x/r.gameWidth*e,n+T.y/r.gameWidth*e,2),K.lineWidth=3,K.fillStyle=B.black,J(a,n,e,t,!0),J(a,n-40,e,30),k(P.get(),a,n-40,e,30,B.teal),w(y.rendergap,a,n-40,e,30,B.pink),d(C,a,n-40,e,30,B.yellow),M.debug[5].draw("Prediction: "+Math.round(C)+"ms",a+e,n-50-70,10,B.guiwhite,"right"),M.debug[4].draw("Update Rate: "+y.updatetime+"Hz",a+e,n-50-56,10,B.guiwhite,"right"),M.debug[3].draw("Latency: "+y.latency+"ms",a+e,n-50-42,10,y.latency<250?B.guiwhite:B.orange,"right"),M.debug[2].draw("Client FPS: "+y.rendertime,a+e,n-50-28,10,y.rendertime>10?B.guiwhite:B.orange,"right"),M.debug[1].draw("Server Speed: "+(100*S.fps).toFixed(2)+"%",a+e,n-50-14,10,1===S.fps?B.guiwhite:B.orange,"right"),M.debug[0].draw(r.servers[r.serverID].location+" :"+r.servers[r.serverID].type+":",a+e,n-50,10,B.guiwhite,"right")}{let e=4,t=H*r.screenWidth,a=14,l=r.screenWidth-t-20,o=20+a+14;M.lbtitle.draw("Leaderboard",Math.round(l+t/2)+.5,Math.round(o-10)+.5,a+4,B.guiwhite,"center");for(let r=0;r<R.data.length;r++){let s=R.data[r];$(l,l+t,o+a/2,a-3+i.graphical.barChunk,B.black),$(l,l+t,o+a/2,a-3,B.grey),$(l,l+t*Math.min(1,s.score/I),o+a/2,a-3.5,s.barcolor),M.leaderboard[r].draw(s.label+": "+n.handleLargeNumber(Math.round(s.score)),l+t/2,o+a/2,a-5,B.guiwhite,"center",!0);let c=a/s.position.axis,d=l-1.5*a-c*s.position.middle.x*.707,h=o+.5*a+c*s.position.middle.x*.707;Z(d,h,s.image,1/c,1,c*c/s.image.size,-Math.PI/4,!0),o+=e+a}}{t.set(0+(r.canUpgrade||r.upgradeHover));let e=t.get();if(r.clickables.upgrade.hide(),S.upgrades.length>0){r.canUpgrade=!0;let t=14,a=H*r.screenWidth/2*1,n=a,l=2*e*20-20,s=20,c=l,d=0,u=s,p=0;m+=.01;let f=10,y=0;S.upgrades.forEach(function(i){s>u&&(u=s),d=l,r.clickables.upgrade.place(y++,l,s,a,n),K.globalAlpha=.5,K.fillStyle=o(f),J(l,s,a,n),K.globalAlpha=.1,K.fillStyle=o(f++-10),J(l,s,a,.6*n),K.fillStyle=B.black,J(l,s+.6*n,a,.4*n),K.globalAlpha=1;let c=g(i,S.color),k=h[i].position,b=.6*a/k.axis,w=l+.5*a-b*k.middle.x*Math.cos(m),x=s+.5*n-b*k.middle.x*Math.sin(m);Z(w,x,c,1,1,b/c.size,m,!0),M.upgradeNames[y-1].draw(c.name,l+.9*a/2,s+n-6,n/8-3,B.guiwhite,"center"),M.upgradeKeys[y-1].draw("["+"yhujikol".charAt(p)+"]",l+a-4,s+n-6,n/8-3,B.guiwhite,"right"),K.strokeStyle=B.black,K.globalAlpha=1,K.lineWidth=3,J(l,s,a,n,!0),p++%2?(s-=n+t,l+=e*(a+t)):s+=n+t});let k=14,b="Don't Upgrade",w=j(b,k-3)+10,x=c+(d+a+t-c)/2,E=u+n+t;$(x-w/2,x+w/2,E+k/2,k+i.graphical.barChunk,B.black),$(x-w/2,x+w/2,E+k/2,k,B.white),M.skipUpgrades.draw(b,x,E+k/2,k-2,B.guiwhite,"center",!0),r.clickables.skipUpgrades.place(0,x-w/2,E,w,k)}else r.canUpgrade=!1,r.clickables.upgrade.hide(),r.clickables.skipUpgrades.hide()}y.lastrender=Y()}})();var ee,te,ae,re;const ne=(()=>{let e={taunt:q(),level:q(),score:q(),time:q(),kills:q(),death:q(),playagain:q()};return()=>{G(B.black,.25);let t=r.screenWidth/2,a=r.screenHeight/2-50,i=g(S.type,S.color),l=h[S.type].position,o=140/l.axis,s=r.screenWidth/2-o*l.middle.x*.707,c=r.screenHeight/2-35+o*l.middle.x*.707;Z(s-190-70,c-10,i,1.5,1,.5*o/i.realSize,-Math.PI/4,!0),e.taunt.draw("lol you died",t,a-80,8,B.guiwhite,"center"),e.level.draw("Level "+S.__s.getLevel()+" "+h[S.type].name+".",t-170,a-30,24,B.guiwhite),e.score.draw("Final score: "+n.formatLargeNumber(Math.round(r.finalScore.get())),t-170,a+25,50,B.guiwhite),e.time.draw("⌚ Survived for "+n.timeForHumans(Math.round(r.finalLifetime.get()))+".",t-170,a+55,16,B.guiwhite),e.kills.draw((()=>{let e=[Math.round(r.finalKills[0].get()),Math.round(r.finalKills[1].get()),Math.round(r.finalKills[2].get())],t=e[0]+.5*e[1]+3*e[2],a=(0===t?"🌼":t<4?"🎯":t<8?"💥":t<15?"💢":t<25?"🔥":t<50?"💣":t<75?"👺":t<100?"🌶️":"💯")+" ";if(0===t)return a+"A true pacifist";let n=[];return e[0]&&n.push(e[0]+" kills"),e[1]&&n.push(e[1]+" assists"),e[2]&&n.push(e[2]+" visitors defeated"),a+n.join(" and ")})(),t-170,a+77,16,B.guiwhite),e.death.draw((()=>r.finalKillers.length?"🔪 Succumbed to "+r.finalKillers.map(e=>n.addArticle(h[e].name)).join(" and ")+".":"🤷 Well that was kinda dumb huh")(),t-170,a+99,16,B.guiwhite),e.playagain.draw("Press enter to respawn!",t,a+125,16,B.guiwhite,"center")}})();window.onbeforeunload=(()=>r.isInGame);const ie=(()=>{let e={connecting:q(),message:q()};return()=>{G(B.white,.5),e.connecting.draw("Connecting...",r.screenWidth/2,r.screenHeight/2,30,B.guiwhite,"center"),e.message.draw(r.message,r.screenWidth/2,r.screenHeight/2+30,15,B.lgreen,"center")}})(),le=(()=>{let e={disconnected:q(),message:q()};return()=>{G(l(B.red,B.guiblack,.3),.25),e.disconnected.draw("💀 Disconnected. 💀",r.screenWidth/2,r.screenHeight/2,30,B.guiwhite,"center"),e.message.draw(r.message,r.screenWidth/2,r.screenHeight/2+30,15,B.orange,"center")}})();function oe(){r.animLoopHandle=window.requestAnimFrame(oe),T.renderv+=(T.view-T.renderv)/30,K.lineCap="round",K.lineJoin="round",r.gameStart&&!r.disconnected&&(r.time=Y(),r.time-k>1e3&&(r.socket.ping(r.time),k=r.time,y.rendertime=b,b=0,y.updatetime=w,w=0),y.lag=r.time-T.time),r.gameStart?Q(_()):r.disconnected||ie(),r.died&&ne(),r.disconnected&&le()}}]);app